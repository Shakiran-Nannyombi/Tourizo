{% extends "base.html" %}

{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card border-0 shadow-lg" style="border-radius: 15px; overflow: hidden;">
        <!-- Card Header with Nature Warning Theme -->
        <div class="card-header py-3" style="background: linear-gradient(to right, #e9c46a, #f4a261);">
          <div class="d-flex align-items-center">
            <i class="fas fa-exclamation-triangle text-dark me-3" style="font-size: 1.8rem;"></i>
            <div>
              <h4 class="mb-0 text-dark">Cancel Booking: {{ booking.reference }}</h4>
              <small class="text-dark opacity-75">We're sorry to see you go</small>
            </div>
          </div>
        </div>

        <!-- Card Body -->
        <div class="card-body" style="background-color: #f8f9fa;">
          <form method="POST" action="{{ url_for('cancel_booking', booking_id=booking.id) }}">
            {{ form.hidden_tag() }}

            <!-- Booking Details Section -->
            <div class="mb-4 p-3 bg-white rounded-3 border-start border-4 border-warning">
              <h5 class="mb-3" style="color: #3a5a40;">
                <i class="fas fa-info-circle me-2"></i>Booking Details
              </h5>

              <div class="row">
                <div class="col-md-6 mb-2">
                  <p><strong><i class="fas fa-map-marked-alt me-2"></i>Package:</strong><br>
                    <span style="color: #588157;">{{ booking.tour.name }}</span>
                  </p>
                </div>
                <div class="col-md-6 mb-2">
                  <p><strong><i class="fas fa-money-bill-wave me-2"></i>Total Amount:</strong><br>
                    <span style="color: #588157;">{{ '{:,.0f}'.format(booking.total_amount) }} UGX</span>
                  </p>
                </div>
              </div>
            </div>

            <p class="mb-0">
              <strong><i class="fas fa-tag me-2"></i>Status:</strong>
              <span
                class="badge bg-{% if booking.payment_status == 'paid' %}success{% elif booking.payment_status == 'cancelled' %}danger{% else %}secondary{% endif %}">
                {{ booking.payment_status|title }}
              </span>
            </p>
        </div>

        <!-- Cancellation Reason -->
        <div class="mb-3">
          <div class="form-floating">
            {{ form.reason(class="form-select", id="reasonSelect", style="border-color: #e0e6dc;") }}
            {{ form.reason.label(class="form-label", for="reasonSelect") }}
          </div>
          {% for error in form.reason.errors %}
          <div class="invalid-feedback d-block">
            <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
          </div>
          {% endfor %}
        </div>

        <!-- Additional Notes -->
        <div class="mb-3">
          <div class="form-floating">
            {{ form.notes(class="form-control", style="border-color: #e0e6dc; height: 100px;", id="notesTextarea",
            placeholder=" ") }}
            {{ form.notes.label(for="notesTextarea") }}
          </div>
        </div>

        <!-- Confirmation Checkbox -->
        <div class="mb-3 form-check ps-0">
          <div class="form-check form-switch">
            {{ form.confirm(class="form-check-input", style="width: 3em; height: 1.5em;", id="confirmSwitch") }}
            <label class="form-check-label ms-2" for="confirmSwitch" style="color: #3a5a40;">
              <i class="fas fa-check-circle me-1"></i>I confirm I want to cancel this booking
            </label>
          </div>
          {% for error in form.confirm.errors %}
          <div class="invalid-feedback d-block">
            <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
          </div>
          {% endfor %}
        </div>

        <!-- Form Actions -->
        <div class="d-flex justify-content-between mt-4">
          <a href="{{ url_for('my_bookings') }}" class="btn btn-outline-secondary rounded-pill px-4">
            <i class="fas fa-arrow-left me-2"></i>Back to Bookings
          </a>

          <button type="submit" class="btn rounded-pill px-4" style="background-color: #f4a261; color: #fff;">
            <i class="fas fa-ban me-2"></i>Confirm Cancellation
          </button>
        </div>
        </form>
      </div>
    </div>
  </div>
</div>
</div>

<style>
  .form-select:focus,
  .form-control:focus {
    border-color: #a5c4a0;
    box-shadow: 0 0 0 0.25rem rgba(233, 196, 106, 0.25);
  }

  .form-switch .form-check-input:checked {
    background-color: #f4a261;
    border-color: #e9c46a;
  }
</style>
{% endblock %}