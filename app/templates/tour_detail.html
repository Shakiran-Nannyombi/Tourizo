{% extends "base.html" %}
{% block title %}{{ tour.title }} - Tour Details{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/tours.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/css/lightbox.min.css">
{% endblock %}

{% block content %}
<!-- Main Site Navbar -->
<nav class="main-navbar">
    <div class="container">
        <a class="navbar-logo" href="{{ url_for('welcome') }}">
            <i class="fas fa-leaf"></i> Tourizo
        </a>
        <div class="nav">
            <a class="nav-link" href="{{ url_for('auth.user_dashboard') }}">Home</a>
            <a class="nav-link active" href="{{ url_for('tours.list_tours') }}">Tours</a>
            <a class="nav-link" href="#">Destinations</a>
            <a class="nav-link" href="#">About</a>
            <a class="nav-link" href="#">Contact</a>
        </div>
        <div class="navbar-actions">
            <button class="wishlist-btn" id="navbar-wishlist-btn" title="Wishlist" onclick="window.location.href='/tours/wishlist'">
                <i class="far fa-heart"></i>
                <span class="wishlist-badge" id="wishlist-badge">0</span>
            </button>
            <form method="POST" action="{{ url_for('auth.logout') }}" style="display:inline;">
                <button type="submit" class="logout-btn">Logout</button>
            </form>
        </div>
    </div>
</nav>

<div class="tour-detail-container">
    <div class="container">
        <!-- Breadcrumb Navigation -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb breadcrumb-nav">
                <li class="breadcrumb-item"><a href="{{ url_for('auth.user_dashboard') }}">Home</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('tours.list_tours') }}">Tours</a></li>
                <li class="breadcrumb-item active" aria-current="page">{{ tour.title }}</li>
            </ol>
        </nav>

        <div class="row">
            <!-- Main Content Section (Left Column) -->
            <div class="col-lg-8">
                <!-- Tour Title and Overview -->
                <div class="tour-overview-section">
                    <h1 class="tour-title-main">{{ tour.title }}</h1>
                    <div class="tour-meta">
                        <div class="tour-location">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>{{ tour.destination }}</span>
                        </div>
                        <div class="tour-rating">
                            <i class="fas fa-star"></i>
                            <span>4.9 (127 reviews)</span>
                        </div>
                    </div>
                    <div class="tour-badges">
                        <span class="tour-badge">
                            <i class="fas fa-calendar"></i>
                            {{ tour.duration }} days
                        </span>
                        <span class="tour-badge">
                            <i class="fas fa-users"></i>
                            {{ tour.min_participants }}-{{ tour.max_participants }} people
                        </span>
                        <span class="tour-badge">
                            <i class="fas fa-shield-alt"></i>
                            Fully Insured
                        </span>
                    </div>
                    <p class="tour-description">{{ tour.description }}</p>
                </div>

                <!-- Main Featured Image -->
                <div class="main-image-container">
                    {% if tour.featured_image %}
                        <img src="{{ url_for('static', filename=tour.featured_image) }}" 
                             alt="{{ tour.title }}" 
                             class="main-image"
                             id="main-tour-image">
                    {% else %}
                        <div class="image-placeholder">
                            <i class="fas fa-mountain"></i>
                        </div>
                    {% endif %}
                </div>

                <!-- Image Gallery - Layout matching the image -->
                <div class="tour-gallery-section">
                    {% if tour.image_gallery %}
                        {% set gallery_images = tour.image_gallery|from_json %}
                        {% if gallery_images|length > 0 %}
                            <div class="image-gallery-grid">
                                <!-- First row: 2 images side by side -->
                                <div class="gallery-item">
                                    <a href="{{ url_for('static', filename='images/tours/' + gallery_images[0]) }}" 
                                       data-lightbox="tour-gallery" 
                                       data-title="{{ tour.title }} - Image 1">
                                        <img src="{{ url_for('static', filename='images/tours/' + gallery_images[0]) }}" 
                                             alt="{{ tour.title }} - Image 1"
                                             class="gallery-image">
                                    </a>
                                </div>
                                <div class="gallery-item">
                                    <a href="{{ url_for('static', filename='images/tours/' + gallery_images[1]) }}" 
                                       data-lightbox="tour-gallery" 
                                       data-title="{{ tour.title }} - Image 2">
                                        <img src="{{ url_for('static', filename='images/tours/' + gallery_images[1]) }}" 
                                             alt="{{ tour.title }} - Image 2"
                                             class="gallery-image">
                                    </a>
                                </div>
                                <!-- Second row: 1 image below the first -->
                                <div class="gallery-item">
                                    <a href="{{ url_for('static', filename='images/tours/' + gallery_images[2]) }}" 
                                       data-lightbox="tour-gallery" 
                                       data-title="{{ tour.title }} - Image 3">
                                        <img src="{{ url_for('static', filename='images/tours/' + gallery_images[2]) }}" 
                                             alt="{{ tour.title }} - Image 3"
                                             class="gallery-image">
                                    </a>
                                </div>
                            </div>
                        {% else %}
                            <div class="no-gallery-images">
                                <i class="fas fa-images"></i>
                                <p>No additional images available for this tour.</p>
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="no-gallery-images">
                            <i class="fas fa-images"></i>
                            <p>No additional images available for this tour.</p>
                        </div>
                    {% endif %}
                </div>

                <!-- Tour Tags/Badges -->
                <div class="tour-tags">
                    <span class="tour-tag primary">{{ tour.category.name }}</span>
                    <span class="tour-tag secondary">{{ tour.difficulty_level }}</span>
                </div>

                <!-- Tour Highlights Section -->
                <div class="tour-highlights-section">
                    <h3 class="section-title">Tour Highlights</h3>
                    <ul class="highlights-list">
                        <li><i class="fas fa-check"></i> Witness the Great Migration (seasonal)</li>
                        <li><i class="fas fa-check"></i> Professional safari guide and driver</li>
                        <li><i class="fas fa-check"></i> All meals and park fees included</li>
                        <li><i class="fas fa-check"></i> Spot the Big Five in their natural habitat</li>
                        <li><i class="fas fa-check"></i> Luxury tented camp accommodation</li>
                        <li><i class="fas fa-check"></i> Small group experience (max {{ tour.max_participants }} people)</li>
                    </ul>
                </div>

                <!-- Detailed Itinerary Section -->
                <div class="tour-itinerary-section">
                    <h3 class="section-title">Detailed Programs</h3>
                    <ul class="itinerary-list">
                        {% for day in itinerary_days %}
                        <li class="itinerary-day">
                            <span class="itinerary-day-circle">Day {{ day.day }}</span>
                            <div class="itinerary-day-content">
                                <span class="itinerary-day-title">{{ day.title }}</span>
                                <span class="itinerary-day-desc">{{ day.description }}</span>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- What's Included / Not Included Section -->
                <div class="tour-inclusions-section">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="inclusion-card">
                                <h5 class="inclusion-title">What's Included</h5>
                                <ul class="inclusion-list">
                                    <li><i class="fas fa-check-circle included"></i> Airport transfers</li>
                                    <li><i class="fas fa-check-circle included"></i> All accommodation</li>
                                    <li><i class="fas fa-check-circle included"></i> All meals during safari</li>
                                    <li><i class="fas fa-check-circle included"></i> Professional guide</li>
                                    <li><i class="fas fa-check-circle included"></i> 4WD safari vehicle</li>
                                    <li><i class="fas fa-check-circle included"></i> Park fees and permits</li>
                                    <li><i class="fas fa-check-circle included"></i> Bottled water</li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="inclusion-card">
                                <h5 class="inclusion-title">Not Included</h5>
                                <ul class="inclusion-list">
                                    <li><i class="far fa-square not-included"></i> International flights</li>
                                    <li><i class="far fa-square not-included"></i> Visa fees</li>
                                    <li><i class="far fa-square not-included"></i> Travel insurance</li>
                                    <li><i class="far fa-square not-included"></i> Personal expenses</li>
                                    <li><i class="far fa-square not-included"></i> Tips and gratuities</li>
                                    <li><i class="far fa-square not-included"></i> Alcoholic beverages</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tour Information Sidebar (Right Column) -->
            <div class="col-lg-4">
                <div class="tour-sidebar">
                    <!-- Price -->
                    <div class="tour-price">${{ "%.0f"|format(tour.price) }}</div>
                    <div class="price-subtitle">per person</div>

                    <!-- Tour Summary -->
                    <div class="tour-info-item">
                        <span class="info-label">Duration</span>
                        <span class="info-value">{{ tour.duration }} days</span>
                    </div>
                    <div class="tour-info-item">
                        <span class="info-label">Group Size</span>
                        <span class="info-value">{{ tour.min_participants }}-{{ tour.max_participants }} people</span>
                    </div>
                    <div class="tour-info-item">
                        <span class="info-label">Difficulty</span>
                        <span class="info-value">{{ tour.difficulty_level }}</span>
                    </div>

                    <!-- Action Buttons -->
                    <a href="{{ url_for('bookings.book', tour_id=tour.id) }}" class="btn btn-book-now">
                        Book Now
                    </a>
                    <div class="wishlist-btn-row">
                        <button class="btn btn-wishlist tour-wishlist{% if tour.id in wishlist_ids %} btn-wishlist-remove active{% else %} btn-wishlist-add{% endif %}" data-tour-id="{{ tour.id }}" id="wishlist-toggle-btn">
                            <i class="{% if tour.id in wishlist_ids %}fas{% else %}far{% endif %} fa-heart"></i> {% if tour.id in wishlist_ids %}Remove from Wishlist{% else %}Add to Wishlist{% endif %}
                        </button>
                    </div>

                    <!-- Contact Information -->
                    <div class="text-center mt-3">
                        <small class="text-muted">Questions about this tour?</small><br>
                        <a href="#" class="contact-link">Contact our travel experts</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    lightbox.option({
        'resizeDuration': 200,
        'wrapAround': true,
        'albumLabel': 'Image %1 of %2'
    });
});
</script>
{% if current_user.is_authenticated %}
<script>window.isLoggedIn = true;</script>
{% else %}
<script>window.isLoggedIn = false;</script>
{% endif %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/user_dashboard_navbar.js') }}"></script>
<script src="{{ url_for('static', filename='js/tours.js') }}"></script>
{% endblock %}